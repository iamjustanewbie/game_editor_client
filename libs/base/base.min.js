var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n},base;!function(e){var t;!function(e){function t(e){var t=typeof e;if(!e)return t;if("object"!==t&&!e.prototype)return t;var n=e.prototype?e.prototype:Object.getPrototypeOf(e),o=n.__class__;return o||(o=n.constructor.name,Object.defineProperty(n,"__class__",{configurable:!1,enumerable:!1,writable:!1,value:o})),o}e.getClassName=t}(t=e.utils||(e.utils={}))}(base||(base={}));var base;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(egret.HashObject);e.ObjBase=t,__reflect(t.prototype,"base.ObjBase")}(base||(base={}));var base;!function(e){var t;!function(t){function n(){return Date.now()}function o(e,t){void 0===t&&(t=!1);var n=e.__poolId__;if(!n){if(!t)return null;n=r(e)+s++,Object.defineProperty(e,"__poolId__",{configurable:!1,enumerable:!1,writable:!1,value:n})}var o=i[n];if(!o){if(!t)return null;o=new a(e,c.DefaultNumLimit),i[n]=o}return o}var r=e.utils.getClassName,i=Object.create(null),s=1e3,a=function(){function e(e,t){this.numLimit=t,this._list=[],this._cls=e,this.time=this._resizeTime=n(),this._allocNum=0}return e.prototype.alloc=function(){this._allocNum++,this.time=n();var e=this._list.length?this._list.pop():new this._cls;return"function"==typeof e.onAlloc&&e.onAlloc(),e},e.prototype.release=function(e){e&&(this._list.length<this.numLimit&&this._list.indexOf(e)<0?("function"==typeof e.onRelease&&e.onRelease(),this._list[this._list.length]=e):"function"==typeof e.dispose&&e.dispose())},e.prototype.resize=function(e){e-this._resizeTime>=c.ResizeThreshold&&(this.numLimit=this._allocNum>c.DefaultNumLimit?this._allocNum:c.DefaultNumLimit,this._allocNum=0,this._resizeTime=e)},e.prototype.dispose=function(){for(var e=0,t=this._list;e<t.length;e++){var n=t[e];"function"==typeof n.dispose&&n.dispose()}this._list.length=0},e}();__reflect(a.prototype,"PoolImpl");var c=function(){function e(){}return e.alloc=function(e){return"function"!=typeof e?null:o(e,!0).alloc()},e.release=function(e){if(e&&"object"==typeof e){var t=o(e.constructor,!1);t&&t.release(e)}},e.checkUnused=function(){var e=n();for(var t in i){var o=i[t];o&&(e-o.time>this.UnusedThreshold?(i[t]=null,o.dispose()):o.resize(e))}},e.DefaultNumLimit=30,e.UnusedThreshold=5e4,e.ResizeThreshold=3e3,e}();t.Pool=c,__reflect(c.prototype,"base.pool.Pool")}(t=e.pool||(e.pool={}))}(base||(base={}));var base;!function(e){var t;!function(t){var n=e.pool.Pool,o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.alloc=function(e,t,r,i){return void 0===r&&(r=null),void 0===i&&(i=!1),n.alloc(o).set(o._guid++,e,t,r?r:[],!!i)},o.equalMethod=function(e,t,n){return e&&t?e._method===t&&e._context===n:!1},o.equal=function(e,t){return e&&t?e._method===t._method&&e._context===t._context:!1},Object.defineProperty(o.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"method",{get:function(){return this._method},enumerable:!0,configurable:!0}),o.prototype.set=function(e,t,n,o,r){var i=this;return i._id=e,i._context=t,i._method=n,i._args=o,i._once=r,i},o.prototype.exec=function(e){var t=this;if(!t._method)return null;var o,r=t._id;o=null==e?t._args:(t._args||e.unshift)&&t._args?t._args.concat(e):e;var i=t.doExec(t._context,t._method,o);return t._id===r&&t._once&&n.release(t),i},o.prototype.doExec=function(e,n,o){var r=null;try{r=n.apply(e,o)}catch(i){var s=void 0;if(e){s=[t.getClassName(e)];for(var a in e)if(e[a]===n){s[s.length]=a;break}}else s=[];i&&(i.stack?s[s.length]=i.stack:(s[s.length]=i.name,s[s.length]=i.message)),console.error(s.join("|"))}return r},o.prototype.dispose=function(){this.onRelease()},o.prototype.onAlloc=function(){},o.prototype.onRelease=function(){var e=this;e._context=null,e._method=null,e._args=void 0,e._once=!1},o._guid=1,o}(e.ObjBase);t.Handler=o,__reflect(o.prototype,"base.utils.Handler",["base.pool.PoolObject","base.pool.DisposeObject"])}(t=e.utils||(e.utils={}))}(base||(base={}));var base;!function(e){var t;!function(t){var n=e.pool.Pool,o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.alloc=function(e,o){var r=n.alloc(t);return r.type=e,r.body=o,r},t.prototype.onAlloc=function(){},t.prototype.onRelease=function(){this.type=null,this.body=null},t.prototype.dispose=function(){this.onRelease()},t}(e.ObjBase);t.GameNT=o,__reflect(o.prototype,"base.module.GameNT",["base.pool.PoolObject","base.pool.DisposeObject"])}(t=e.module||(e.module={}))}(base||(base={}));var base;!function(e){var t;!function(t){var n=e.utils.Handler,o=e.pool.Pool,r=egret.getTimer,i=function(e){function i(){var t=e.call(this)||this;return t.lReqTime=0,t.reqCnt=0,t.lRspdTime=0,t.rspdCnt=0,t.init(),t}return __extends(i,e),i.prototype.init=function(){var e=this;e.socket=new t.Socket,e.socket.onOpen=n.alloc(e,e.onSocketOpen),e.socket.onClose=n.alloc(e,e.onSocketClose),e.socket.onError=n.alloc(e,e.onSocketError),e.socket.onMessage=n.alloc(e,e.onMessage)},i.prototype.connect=function(e){t.traceProto("connect to:",e),this.socket.connect(e)},Object.defineProperty(i.prototype,"isConnected",{get:function(){return this.socket.connected},enumerable:!0,configurable:!0}),i.prototype.disconnect=function(){if(this.socket)try{this.socket.close()}catch(e){}},i.prototype.send=function(e){var n=this;if(null!=e&&n.isConnected){var o=i.encodeMsg(e);if(o){var s=r();s-n.lReqTime>=1e3?(t.traceProto("每秒发送：",n.reqCnt),n.lReqTime=s,n.reqCnt=0):n.reqCnt++,n.socket.send(o)}}},i.prototype.onMessage=function(e){var n=this,o=i.decodeMsg(e);if(o){var s=r();s-n.lRspdTime>=1e3?(t.traceProto("每秒接收：",n.rspdCnt),n.lRspdTime=s,n.rspdCnt=0):n.rspdCnt++,null!=n.onMsgReceive&&n.onMsgReceive.exec([o])}},i.encodeMsg=function(e){if("object"!=typeof e)return null;var n=e.constructor,o=n.MsgId;if(!isNaN(o)){if(o>0){var r=e.constructor.encode(e).finish(),i=new Uint8Array(r.length+2);return new DataView(i.buffer).setUint16(0,o),i.set(r,2),t.traceProto("发送协议：",e),i}return t.traceProto("发送无效的协议：",e),null}},i.decodeMsg=function(e){var n=new DataView(e).getUint16(0),o=new Uint8Array(e,2),r=t.IdMsg[n];if(r&&r.decode){var i=r.decode(o);return t.traceProto("接收协议：",i),i}return t.traceProto("接收到未知协议：id",n),null},i.prototype.onSocketOpen=function(){t.traceProto("on socket open"),this.onCreated&&this.onCreated.exec()},i.prototype.onSocketClose=function(){t.traceProto("on socket close"),this.onLost&&this.onLost.exec()},i.prototype.onSocketError=function(){var e=this;t.traceProto("on socket error"),e.onError&&e.onError.exec()},i.prototype.dispose=function(){var e=this;e.socket&&(o.release(e.onMsgReceive),e.onMsgReceive=void 0,o.release(e.onCreated),e.onCreated=void 0,o.release(e.onLost),e.onLost=void 0,o.release(e.onError),e.onError=void 0,e.disconnect(),e.socket.dispose(),e.socket=void 0)},i}(e.ObjBase);t.Connection=i,__reflect(i.prototype,"base.network.Connection")}(t=e.network||(e.network={}))}(base||(base={}));var base;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.easeIn=function(e,t,n,o,r){return void 0===r&&(r=1.70158),n*(e/=o)*e*((r+1)*e-r)+t},e.easeOut=function(e,t,n,o,r){return void 0===r&&(r=1.70158),n*((e=e/o-1)*e*((r+1)*e+r)+1)+t},e.easeInOut=function(e,t,n,o,r){return void 0===r&&(r=1.70158),(e/=.5*o)<1?.5*n*(e*e*(((r*=1.525)+1)*e-r))+t:n/2*((e-=2)*e*(((r*=1.525)+1)*e+r)+2)+t},e.easeOutExtra=function(e,t,n,o,r){return void 0===r&&(r=8),n*((e=e/o-1)*e*((r+1)*e+r)+1)+t},e}();e.Back=t,__reflect(t.prototype,"base.tween.easing.Back");var n=function(){function e(){}return e.easeOut=function(e,t,n,o){return(e/=o)<1/2.75?n*(7.5625*e*e)+t:2/2.75>e?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:2.5/2.75>e?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},e.easeIn=function(t,n,o,r){return o-e.easeOut(r-t,0,o,r)+n},e.easeInOut=function(t,n,o,r){return.5*r>t?.5*e.easeIn(2*t,0,o,r)+n:.5*e.easeOut(2*t-r,0,o,r)+.5*o+n},e}();e.Bounce=n,__reflect(n.prototype,"base.tween.easing.Bounce");var o=function(){function e(){}return e.easeIn=function(e,t,n,o){return-n*(Math.sqrt(1-(e/=o)*e)-1)+t},e.easeOut=function(e,t,n,o){return n*Math.sqrt(1-(e=e/o-1)*e)+t},e.easeInOut=function(e,t,n,o){return(e/=.5*o)<1?.5*-n*(Math.sqrt(1-e*e)-1)+t:.5*n*(Math.sqrt(1-(e-=2)*e)+1)+t},e}();e.Circ=o,__reflect(o.prototype,"base.tween.easing.Circ");var r=function(){function e(){}return e.easeIn=function(e,t,n,o){return n*(e/=o)*e*e+t},e.easeOut=function(e,t,n,o){return n*((e=e/o-1)*e*e+1)+t},e.easeInOut=function(e,t,n,o){return(e/=.5*o)<1?.5*n*e*e*e+t:.5*n*((e-=2)*e*e+2)+t},e.power=2,e}();e.Cubic=r,__reflect(r.prototype,"base.tween.easing.Cubic");var i=function(){function e(){}return e.easeIn=function(t,n,o,r,i,s){void 0===i&&(i=0),void 0===s&&(s=0);var a;return 0==t?n:1==(t/=r)?n+o:(s||(s=.3*r),!i||o>0&&o>i||0>o&&-o>i?(i=o,a=s/4):a=s/e._2PI*Math.asin(o/i),-(i*Math.pow(2,10*(t-=1))*Math.sin((t*r-a)*e._2PI/s))+n)},e.easeOut=function(t,n,o,r,i,s){void 0===i&&(i=0),void 0===s&&(s=0);var a;return 0==t?n:1==(t/=r)?n+o:(s||(s=.3*r),!i||o>0&&o>i||0>o&&-o>i?(i=o,a=s/4):a=s/e._2PI*Math.asin(o/i),i*Math.pow(2,-10*t)*Math.sin((t*r-a)*e._2PI/s)+o+n)},e.easeInOut=function(t,n,o,r,i,s){void 0===i&&(i=0),void 0===s&&(s=0);var a;return 0==t?n:2==(t/=.5*r)?n+o:(s||(s=r*(.3*1.5)),!i||o>0&&o>i||0>o&&-o>i?(i=o,a=s/4):a=s/e._2PI*Math.asin(o/i),1>t?-.5*(i*Math.pow(2,10*(t-=1))*Math.sin((t*r-a)*e._2PI/s))+n:i*Math.pow(2,-10*(t-=1))*Math.sin((t*r-a)*e._2PI/s)*.5+o+n)},e._2PI=2*Math.PI,e}();e.Elastic=i,__reflect(i.prototype,"base.tween.easing.Elastic");var s=function(){function e(){}return e.easeIn=function(e,t,n,o){return 0==e?t:n*Math.pow(2,10*(e/o-1))+t-.001*n},e.easeOut=function(e,t,n,o){return e==o?t+n:n*(-Math.pow(2,-10*e/o)+1)+t},e.easeInOut=function(e,t,n,o){return 0==e?t:e==o?t+n:(e/=.5*o)<1?.5*n*Math.pow(2,10*(e-1))+t:.5*n*(-Math.pow(2,-10*--e)+2)+t},e}();e.Expo=s,__reflect(s.prototype,"base.tween.easing.Expo");var a=function(){function e(){}return e.easeIn=function(t,n,o,r){return-o*Math.cos(t/r*e._HALF_PI)+o+n},e.easeOut=function(t,n,o,r){return o*Math.sin(t/r*e._HALF_PI)+n},e.easeInOut=function(e,t,n,o){return.5*-n*(Math.cos(Math.PI*e/o)-1)+t},e._HALF_PI=.5*Math.PI,e}();e.IntegerSine=a,__reflect(a.prototype,"base.tween.easing.IntegerSine");var c=function(){function e(){}return e.easeNone=function(e,t,n,o){return n*e/o+t},e.easeIn=function(e,t,n,o){return n*e/o+t},e.easeOut=function(e,t,n,o){return n*e/o+t},e.easeInOut=function(e,t,n,o){return n*e/o+t},e.power=0,e}();e.Linear=c,__reflect(c.prototype,"base.tween.easing.Linear");var u=function(){function e(){}return e.easeIn=function(e,t,n,o){return n*(e/=o)*e+t},e.easeOut=function(e,t,n,o){return-n*(e/=o)*(e-2)+t},e.easeInOut=function(e,t,n,o){return(e/=.5*o)<1?.5*n*e*e+t:.5*-n*(--e*(e-2)-1)+t},e.power=1,e}();e.Quad=u,__reflect(u.prototype,"base.tween.easing.Quad");var l=function(){function e(){}return e.easeIn=function(e,t,n,o){return n*(e/=o)*e*e*e+t},e.easeOut=function(e,t,n,o){return-n*((e=e/o-1)*e*e*e-1)+t},e.easeInOut=function(e,t,n,o){return(e/=.5*o)<1?.5*n*e*e*e*e+t:.5*-n*((e-=2)*e*e*e-2)+t},e.power=3,e}();e.Quart=l,__reflect(l.prototype,"base.tween.easing.Quart");var p=function(){function e(){}return e.easeIn=function(e,t,n,o){return n*(e/=o)*e*e*e*e+t},e.easeOut=function(e,t,n,o){return n*((e=e/o-1)*e*e*e*e+1)+t},e.easeInOut=function(e,t,n,o){return(e/=.5*o)<1?.5*n*e*e*e*e*e+t:.5*n*((e-=2)*e*e*e*e+2)+t},e.power=4,e}();e.Quint=p,__reflect(p.prototype,"base.tween.easing.Quint");var f=function(){function e(){}return e.easeIn=function(t,n,o,r){return-o*Math.cos(t/r*e._HALF_PI)+o+n},e.easeOut=function(t,n,o,r){return o*Math.sin(t/r*e._HALF_PI)+n},e.easeInOut=function(e,t,n,o){return.5*-n*(Math.cos(Math.PI*e/o)-1)+t},e._HALF_PI=.5*Math.PI,e}();e.Sine=f,__reflect(f.prototype,"base.tween.easing.Sine");var _=function(){function e(){}return e.easeIn=function(e,t,n,o){return n*(e/=o)*e*e*e*e+t},e.easeOut=function(e,t,n,o){return n*((e=e/o-1)*e*e*e*e+1)+t},e.easeInOut=function(e,t,n,o){return(e/=.5*o)<1?.5*n*e*e*e*e*e+t:.5*n*((e-=2)*e*e*e*e+2)+t},e.power=4,e}();e.Strong=_,__reflect(_.prototype,"base.tween.easing.Strong")}(t=e.easing||(e.easing={}))}(t=e.tween||(e.tween={}))}(base||(base={}));var base;!function(e){var t;!function(t){var n=e.pool.Pool,o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._prev=null,t._next=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"prev",{get:function(){return this._prev},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"next",{get:function(){return this._next},enumerable:!0,configurable:!0}),t.prototype.addToTail=function(e){var t=this;return t._prev=e,t._next=e._next,e._next=t,t._next&&(t._next._prev=t),t},t.prototype.remove=function(){var e=this;return e._prev?(e._prev._next=e._next,e._next&&(e._next._prev=e._prev)):e._next&&(e._next._prev=null),e._prev=e._next=null,e},t.prototype.setData=function(e){return this.data=e,this},t.prototype.onAlloc=function(){},t.prototype.onRelease=function(){this.remove(),this.data=null},t.prototype.dispose=function(){this.onRelease()},t}(e.ObjBase);t.LinkedNode=o,__reflect(o.prototype,"base.utils.LinkedNode",["base.pool.PoolObject","base.pool.DisposeObject"]);var r=function(e){function t(){var t=e.call(this)||this;return t.head=n.alloc(o),t.tail=n.alloc(o).addToTail(t.head),t}return __extends(t,e),Object.defineProperty(t.prototype,"begin",{get:function(){return this.head.next},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"end",{get:function(){return this.tail},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this.head.next===this.tail},enumerable:!0,configurable:!0}),t.prototype.push=function(e){return n.alloc(o).setData(e).addToTail(this.tail.prev)},t.prototype.unshift=function(e){return n.alloc(o).setData(e).addToTail(this.head)},t.prototype.remove=function(e){var t=this.find(e);return t?(n.release(t),!0):!1},t.prototype.find=function(e){if(!e)return null;for(var t=this.begin,n=this.end;t!==n;){if(t.data===e)return t;t=t.next}return null},t.prototype.find2=function(e){if(!e)return null;for(var t=this.begin,n=this.end;t!==n;){if(e(t.data))return t;t=t.next}return null},t.prototype.clone=function(){for(var e=n.alloc(t),o=this.begin,r=this.end;o!==r;)e.push(o.data),o=o.next;return e},t.prototype.onAlloc=function(){},t.prototype.onRelease=function(){for(var e,t=this.begin,o=this.end;t!==o;)e=t,t=t.next,n.release(e)},t.prototype.dispose=function(){this.onRelease(),n.release(this.head),n.release(this.tail)},t}(e.ObjBase);t.LinkedList=r,__reflect(r.prototype,"base.utils.LinkedList",["base.pool.PoolObject","base.pool.DisposeObject"])}(t=e.utils||(e.utils={}))}(base||(base={}));var base;!function(e){var t;!function(t){var n=e.network.Connection,o=e.utils.Handler,r=function(r){function s(){var e=r.call(this)||this;return e._recvTick=0,e.init(),e}return __extends(s,r),s.prototype.init=function(){var e=this;e._blockInfo=new i,e._blockList=[]},s.prototype.connectTo=function(e,t){var r=this;r._connection&&(r._connection.dispose(),r._connection=void 0),r._connection=new n,r._connection.onMsgReceive=o.alloc(r,r.onMsgReceive),r._connection.onCreated=o.alloc(r,r.onCreate),r._connection.onLost=o.alloc(r,r.onLost),r._connection.onError=o.alloc(r,r.onError),r._connection.connect(e+":"+t)},s.prototype.isConnected=function(){return this._connection&&this._connection.isConnected?36e4>egret.getTimer()-this._recvTick:!1},s.prototype.close=function(){void 0!==this._connection&&this._connection.disconnect()},s.prototype.onCreate=function(){e.module.facade.sendNt(t.ON_CONNECT_CREATE)},s.prototype.onLost=function(){t.onMsg(t.ON_CONNECT_LOST)},s.prototype.onError=function(){t.onMsg(t.ON_CONNECT_ERROR)},s.prototype.onMsgReceive=function(e){this._recvTick=egret.getTimer();var n=t.getProtoName(e);this._blockInfo.isBlock(n)?this._blockList.push(e):this.procProto(e)},s.prototype.procProto=function(e){t.onMsg(e)},s.prototype.setWhiteList=function(e){for(var n=0,o=e.length;o>n;n++){var r=e[n];"string"!=typeof r&&(e[n]=t.getProtoName(r))}this._blockInfo.whiteList=e},s.prototype.startBlock=function(e){this._blockInfo.rule=e,this._blockInfo.isStart=!0},s.prototype.endBlock=function(){for(this._blockInfo.isStart=!1;this._blockList.length;)this.procProto(this._blockList.shift())},s.prototype.onNt=function(n,o,r){e.module.facade.onNt(t.getProtoName(n),o,r)},s.prototype.offNt=function(n,o,r){e.module.facade.offNt(t.getProtoName(n),o,r)},s.prototype.sendProto=function(e){this._connection.send(e)},s}(e.ObjBase);t.GameService=r,__reflect(r.prototype,"base.network.GameService");var i=function(){function e(){this.whiteList=[]}return e.prototype.isBlock=function(e){return this.isStart?this.whiteList.indexOf(e)>-1?!1:e.indexOf(this.rule)<0:!1},e}();__reflect(i.prototype,"BlockInfo")}(t=e.network||(e.network={}))}(base||(base={}));var base;!function(e){var t;!function(e){var t=egret.getTimer,n=function(){function e(){this._serverStartTime=0,this._serverTimeInit=0,this._localTimeInit=0,this._time=t()}return Object.defineProperty(e.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serverTime",{get:function(){if(0==this._serverTimeInit)return 0;var e=t()-this._localTimeInit;return 1e3*this._serverStartTime+10*this._serverTimeInit+e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serverTimeSecond",{get:function(){if(0==this._serverTimeInit)return 0;var e=Math.floor((t()-this._localTimeInit)/1e3);return this._serverStartTime+Math.floor(this._serverTimeInit/100)+e},enumerable:!0,configurable:!0}),e.prototype.__update=function(){this._time=t()},e.prototype.__setServerTime=function(e,n){void 0===n&&(n=0),0!=n&&(this._serverStartTime=n),this._localTimeInit=t(),this._serverTimeInit=e},e}();e.Time=n,__reflect(n.prototype,"base.time.Time")}(t=e.time||(e.time={}))}(base||(base={}));var base;!function(e){var t;!function(t){var n=e.utils.Handler,o=e.pool.Pool,r=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.request=function(e,r,i,s,a){t.webRequest(e,r,function(e){if(null!=s){var t=n.alloc(i,s);t.exec(e),o.release(t)}},function(){if(null!=a){var e=n.alloc(i,a);e.exec(),o.release(e)}})},r}(e.ObjBase);t.WebService=r,__reflect(r.prototype,"base.network.WebService")}(t=e.network||(e.network={}))}(base||(base={}));var base;!function(e){var t;!function(t){var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.sendNt=function(e,n){t.facade.sendNt(e,n)},n}(e.ObjBase);t.Notifier=n,__reflect(n.prototype,"base.module.Notifier")}(t=e.module||(e.module={}))}(base||(base={}));var base;!function(e){var t;!function(t){var n=e.pool.Pool,o=e.utils.LinkedList,r=e.tween.easing.Linear,i=function(){function e(){this._target=null,this._loop=!1,this._steps=[],this._curIdx=0,this._curTime=0,this._isComplete=!1}return e.get=function(t,n){void 0===n&&(n=null);var o=new e;return o._init(t,n),o},e.remove=function(e){for(var t=function(t){return t&&t._target===e},n=this._tweens.find2(t);n;){var o=n.data;o.dispose(),this._tweens.remove(o),n=this._tweens.find2(t)}},e.onTick=function(e){var t=e.time-this._lastTick;this._lastTick=e.time;for(var o=this._tweens.clone(),r=o.begin,i=o.end,s=this._tmpDel,a=0;r!=i;){var c=r.data;r=r.next,c.advanceTime(t),c._isComplete&&(s[a++]=c)}for(var u=0,l=s.length;l>u;u++){var p=s[u];p&&(p.dispose(),this._tweens.remove(p)),s[u]=null}n.release(o)},e._reg=function(e){this._tweens.push(e)},e._checkDuration=function(e){return e=0|+e,0>e&&(e=0),e},e._parseVars=function(e){var t=Object.create(null);for(var n in e){var o=e[n];"number"==typeof o&&(t[n]=o)}return t},e.copyFrom=function(e,t){var n=Object.create(null);for(var o in e)n[o]=t[o];return n},e.prototype._init=function(t,n){void 0===n&&(n=null),this._target=t,this._loop=n&&n.loop,this._curIdx=0,this._curTime=0,this._isComplete=!1,e._reg(this)},e.prototype.to=function(t,n,o,i){if(void 0===o&&(o=null),void 0===i&&(i=r.easeNone),!t)return this;i=i||r.easeNone,n=e._checkDuration(n);var s=this.getTotalTime(),a=e._parseVars(t);return this._steps.push({st:s,et:s+n,to:a,e:i,h:o}),this},e.prototype.from=function(t,n,o,i){if(void 0===o&&(o=null),void 0===i&&(i=r.easeNone),!t)return this;i=i||r.easeNone,n=e._checkDuration(n);var s=this.getTotalTime(),a=e._parseVars(t);return this._steps.push({st:s,et:s+n,from:a,e:i,h:o}),this},e.prototype.delay=function(t){t=e._checkDuration(t);var n=this.getTotalTime();return this._steps.push({st:n,et:n+t}),this},e.prototype.exec=function(e){var t=this.getTotalTime();return this._steps.push({st:t,et:t,h:e}),this},e.prototype.getTotalTime=function(){var e=this._steps;return e.length?e[e.length-1].et:0},e.prototype.applyCur=function(t){void 0===t&&(t=!1);var n=this,o=n._steps[n._curIdx];if(o){if(t){if(!o.to&&!o.from)return void(o.h&&o.h.exec());o.from||(o.from=e.copyFrom(o.to,n._target)),o.to||(o.to=e.copyFrom(o.from,n._target))}if(o.from){var r=n._curTime>o.et?o.et:n._curTime,i=o.et-o.st,s=r-o.st;for(var a in o.to){var c=o.from[a],u=o.to[a],l=o.e(s,c,u-c,i);n._target[a]=l}o.h&&o.h.exec()}}},e.prototype.advanceTime=function(e){var t=this;if(!(0>=e||t._isComplete)){var n=t._steps.length-1;if(!(0>n)){var o=t.getTotalTime();if(t._loop&&t._curTime>=o&&(t._curTime=0,t._curIdx=0),t.applyCur(0===t._curTime),t._curTime<o){t._curTime+=e,t.applyCur();for(var r=t._steps[t._curIdx];r&&t._curTime>=r.et;){if(t._curIdx===n){if(!t._loop){t._isComplete=!0,t._curTime=o;break}t._curTime-=o,t._curIdx=0}else t._curIdx++,t.applyCur(!0);r=t._steps[t._curIdx]}t._curIdx===n&&t._curTime===o&&(t._isComplete=!0)}}}},e.prototype.dispose=function(){for(var e=0,t=this._steps;e<t.length;e++){var o=t[e];n.release(o.h),o.h=null}this._steps.length=0},e._tweens=n.alloc(o),e._lastTick=0,e._tmpDel=new Array(100),e}();t.Tween=i,__reflect(i.prototype,"base.tween.Tween")}(t=e.tween||(e.tween={}))}(base||(base={}));var base;!function(e){var t;!function(t){function n(e,n){n.MsgId=e,t.IdMsg[e]=n}function o(e){return"string"==typeof e?e:egret.getQualifiedClassName(e)}t.ON_CONNECT_CREATE="on_connect_create",t.ON_CONNECT_LOST="on_connect_lost",t.ON_CONNECT_ERROR="on_connect_error",t.IdMsg=Object.create(null),t.__reg=n,t.getProtoName=o;var r=function(n){function r(){var r=n.call(this)||this;return"function"!=typeof t.traceProto&&(t.traceProto=function(e,t){}),"function"!=typeof t.webRequest&&(t.webRequest=function(e,t,n,o){"function"==typeof o&&o()}),"function"!=typeof t.onMsg&&(t.onMsg=function(t){e.module.facade.sendNt(o(t),t)}),r.game=new t.GameService,r.web=new t.WebService,r}return __extends(r,n),r}(e.ObjBase);t.NetworkService=r,__reflect(r.prototype,"base.network.NetworkService")}(t=e.network||(e.network={}))}(base||(base={}));var base;!function(e){var t;!function(t){var n=e.network.NetworkService,o=function(e){function t(){var n=e.call(this)||this;return n.gameService=t._service.game,n.webService=t._service.web,n}return __extends(t,e),t.prototype.getData=function(){return null},t.prototype.initialize=function(){},t.prototype.onStartReconnect=function(){},t.prototype.onProto=function(e,t,n){this.gameService.onNt(e,t,n)},t.prototype.offProto=function(e,t,n){this.gameService.offNt(e,t,n)},t.prototype.sendProto=function(e){this.gameService.sendProto(e)},t._service=new n,t}(t.Notifier);t.ProxyBase=o,__reflect(o.prototype,"base.module.ProxyBase")}(t=e.module||(e.module={}))}(base||(base={}));var base;!function(e){var t;!function(t){var n=e.utils.LinkedList,o=egret.ticker,r=e.pool.Pool,i=egret.getTimer,s=e.tween.Tween,a="__updateData__",c=function(){function e(){var e=this;this._isActivate=!0,this._lastUpdate=0,this._time=new t.Time,this._itemList=r.alloc(n),egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){e.onUpdate()}}),egret.lifecycle.onPause=this.onPause,egret.lifecycle.onResume=this.onResume}return e.init=function(){e._instance||(e._instance=new e)},Object.defineProperty(e,"isActivate",{get:function(){return this._instance._isActivate},enumerable:!0,configurable:!0}),Object.defineProperty(e,"time",{get:function(){return this._instance._time},enumerable:!0,configurable:!0}),e.addUpdateItem=function(e,t){void 0===t&&(t=0);var n=this._instance._itemList,o=n.find(e);if(null==o){var r=new u(this._instance._time.time);if(!(0|+t)){var i=egret.lifecycle.stage.frameRate;t=Math.floor(1e3/i)}r.interval=t,e[a]=r,this._instance._itemList.push(e)}},e.removeUpdateItem=function(e){var t=this._instance._itemList,n=t.find(e);null!=n&&(e[a]=void 0,delete e[a],this._instance._itemList.remove(e))},e.setServerTime=function(e,t){void 0===t&&(t=0),this._instance._time.__setServerTime(e,t)},e.getCount=function(e){var t=this._instance._itemList,n=t.find(e);if(void 0==n)return 0;var o=e[a];return o._updateCnt},e.getElapseTime=function(e){var t=this._instance._itemList,n=t.find(e);if(void 0==n)return 0;var o=e[a];return o._elapseTime},e.setWorker=function(t){var n=e._instance;t&&(n._worker=t,n._worker.onmessage=n.onTimeout)},e.prototype.onTimeout=function(){var t=e._instance;i()-t._lastUpdate<30||t.onUpdate()},e.prototype.onUpdate=function(){var e=this,t=i();if(!(t-e._lastUpdate<16)){e._lastUpdate=t,e._time.__update();for(var n,o=e._itemList.clone(),c=o.begin,u=o.end;c!=u;){n=c.data,c=c.next;var l=n[a];if(l&&(l.clac(e._time.time),l._updateCnt>0))try{n.update(e._time)}catch(p){p&&(p.stack?console.error(p.stack):console.error(p))}}r.release(o),s.onTick(e._time),r.checkUnused()}},e.prototype.onPause=function(){var t=e._instance;t._isActivate=!1,t._worker&&t._worker.postMessage("start"),e.needPause&&o.pause()},e.prototype.onResume=function(){var t=e._instance;t._worker&&t._worker.postMessage("stop"),t._isActivate=!0,o.resume()},e.needPause=!0,e}();t.TimeMgr=c,__reflect(c.prototype,"base.time.TimeMgr");var u=function(){function e(e){this._updateCnt=0,this._updateTime=e}return e.prototype.clac=function(e){var t=this,n=0;t._elapseTime=e-t._updateTime,n=0==t.interval?1:Math.floor(t._elapseTime/t.interval),n>0&&(t._updateTime=e),t._updateCnt=n},e}();__reflect(u.prototype,"UpdateData")}(t=e.time||(e.time={}))}(base||(base={}));var base;!function(e){var t;!function(e){var t=egret.getQualifiedClassName,n=base.utils.Handler,o=base.pool.Pool,r=function(r){function i(e){var n=r.call(this)||this;return n._show=!1,n._parent=e,n._mdrName=t(n),n._ntHandler=Object.create(null),n}return __extends(i,r),Object.defineProperty(i.prototype,"name",{get:function(){return this._mdrName},enumerable:!0,configurable:!0}),i.prototype.$setOwner=function(e){this._owner=e},i.prototype.$setType=function(e){this._type=e},i.prototype.mark=function(e,t){this._viewKey={key:e,type:t}},i.prototype.newView=function(){var e=this;e._viewKey&&(e[e._viewKey.key]=new e._viewKey.type)},i.prototype.getView=function(){var e=this;return e._viewKey?e[e._viewKey.key]:void 0},i.prototype.onNt=function(t,o,r){var i=this,s=i._ntHandler[t];n.equalMethod(s,o,r)||(i._ntHandler[t]=n.alloc(r,o),e.facade.onNt(t,i.notifyObservers,i))},i.prototype.offNt=function(t){var n=this,r=n._ntHandler[t];delete n._ntHandler[t],o.release(r),e.facade.offNt(t,n.notifyObservers,n)},i.prototype.offNtAll=function(){for(var e in this._ntHandler)this.offNt(e)},i.prototype.notifyObservers=function(e){var t=this._ntHandler[e.type];t&&t.exec(e)},i.prototype.show=function(t){var o=this;o._show=!0,o._showArgs=t,o._asset&&o._asset.length&&"function"==typeof e.loadGroupList?e.loadGroupList(o._asset,n.alloc(o,o.onLoadComplete)):o.onLoadComplete()},i.prototype.hide=function(){var e=this;if(e._show){e._show=!1,e._tab&&e._tab.hide(),e.offNtAll(),e.removeListeners();var t=e.getView();t&&t.parent&&t.parent.removeChild(t);try{this.aftHide()}catch(n){this.onErr(n)}finally{this._owner.remMdr(this._type)}}},i.prototype.aftHide=function(){this.onHide(),this._showArgs=null},i.prototype.dispose=function(){this._tab&&(this._tab.dispose(),this._tab=void 0)},i.prototype.onLoadComplete=function(){var e=this;if(e._show){e._viewInit||(e._viewInit=!0,e.newView(),Object.defineProperty(e.getView(),"__mdr__",{value:e,enumerable:!1,writable:!0}),e.onAssetLoaded(),e.onInit());try{e.preShow()}catch(t){e.onErr(t)}}},i.prototype.onErr=function(e){var t=[this._mdrName];e&&(e.stack?t.push(e.stack):(t.push(e.name),t.push(e.message))),console.error(t.join("|"))},i.prototype.preShow=function(){var e=this;e._parent.addChild(e.getView()),e.addListeners(),e.onShow()},i.prototype.onAssetLoaded=function(){},i.prototype.onInit=function(){},i.prototype.addListeners=function(){},i.prototype.removeListeners=function(){},i.prototype.onShow=function(){},i.prototype.onHide=function(){},i.prototype.showView=function(e,t){this._owner.showView(e,t)},i.prototype.retProxy=function(e){return this._owner.retProxy(e)},i.prototype.genMdrTab=function(e,t){if(this._tab)return void console.error(this.name+"重复genMdrTab");var n=new e(this._owner,this.getView(),t);return this._tab=n},i}(e.Notifier);e.MdrBase=r,__reflect(r.prototype,"base.module.MdrBase",["base.pool.DisposeObject"])}(t=e.module||(e.module={}))}(base||(base={}));var base;!function(e){var t;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.exec=function(e){},t.prototype.$setOwner=function(e){this.owner=e},t.prototype.retProxy=function(e){return this.owner.retProxy(e)},t}(e.Notifier);e.CmdBase=t,__reflect(t.prototype,"base.module.CmdBase")}(t=e.module||(e.module={}))}(base||(base={}));var base;!function(e){var t;!function(t){var n=e.time.TimeMgr,o=function(e){function o(t){var n=e.call(this)||this;return n._a=!1,n.init(t),n}return __extends(o,e),o.prototype.init=function(e){var n=this;n._name=e,n._mdrCls=Object.create(null),n._mdrIns=Object.create(null),n._models=Object.create(null),n._controllers=Object.create(null),n._remList=Object.create(null),t.facade.regMod(n)},o.prototype.getName=function(){return this._name},o.prototype.onRegister=function(){this.initCmd(),this.initModel(),this.initView()},o.prototype.initCmd=function(){},o.prototype.initModel=function(){},o.prototype.initView=function(){},o.prototype.regCmd=function(e,n){t.facade.onNt(e,this.executeCommand,this),this._controllers[e]=n},o.prototype.unregCmd=function(e){delete this._controllers[e]},o.prototype.regProxy=function(e,t){var n=new t;this._models[e]=n,n.initialize()},o.prototype.retProxy=function(e){return this._models[e]},o.prototype.regMdr=function(e,t){this._mdrCls[e]=t},o.prototype.executeCommand=function(e){var t=this._controllers[e.type];if(void 0!=t){var n=new t;n.$setOwner(this),n.exec(e)}},o.prototype.showView=function(e,t){var n=this;if(n._mdrCls[e]){delete this._remList[e];var o=n._mdrIns[e];o||(o=n._mdrIns[e]=new n._mdrCls[e],o.$setOwner(n),o.$setType(e)),o.show(t)}},o.prototype.hideView=function(e){var t=this;if(t._mdrCls[e]){var n=t._mdrIns[e];n&&n.hide()}},o.prototype.remMdr=function(e){this._remList[e]=n.time.time,this._a||n.addUpdateItem(this)},o.prototype.onConnectLost=function(){for(var e in this._models){var t=this._models[e];t&&t.onStartReconnect()}},o.prototype.update=function(e){var t=this,r=o.tmpD;r.length=0;var i=e.time,s=0;for(var a in t._remList){var c=t._remList[a];if(i-c>2100){r.push(a);var u=t._mdrIns[a];t._mdrIns[a]=void 0,delete t._mdrIns[a],u&&u.dispose()}s++}s===r.length&&(n.removeUpdateItem(t),t._a=!1);for(var l=0,p=r.length;p>l;l++)delete t._remList[r[l]];r.length=0},o.tmpD=[],o}(e.ObjBase);t.ModBase=o,__reflect(o.prototype,"base.module.ModBase",["base.time.UpdateItem"])}(t=e.module||(e.module={}))}(base||(base={}));var base;!function(e){var t;!function(t){function n(e,t){return a.add(e,0|+t)}function o(e){0!==e&&a.rem(e)}var r=e.pool.Pool,i=egret.HashObject,s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this
}return __extends(t,e),t.prototype.dispose=function(){this.onRelease()},t.prototype.onAlloc=function(){},t.prototype.onRelease=function(){r.release(this.handler),this.handler=null},t}(i);__reflect(s.prototype,"DelayItem",["base.pool.PoolObject","base.pool.DisposeObject"]);var a=function(){function e(){}return e.add=function(e,n){var o=this,i=r.alloc(s);return i.idx=++o.index,i.end=t.TimeMgr.time.time+n,i.handler=e,o.items[i.idx]=i,o.cnt++,o.check(),i.idx},e.rem=function(e){var t=this,n=t.items[e];n&&(this.cnt--,t.items[e]=null,delete t.items[e],r.release(n),t.check())},e.check=function(){var e=this;if(e.cnt>0){if(e.added)return;return e.added=!0,void t.TimeMgr.addUpdateItem(e)}e.added&&(e.added=!1,t.TimeMgr.removeUpdateItem(e))},e.update=function(e){var t=this._tmpDel,n=0;for(var o in this.items){var r=this.items[o];!r||e.time<r.end||(r.handler.exec(),t[n++]=r.idx)}for(var i=0,s=t.length;s>i;i++){var a=t[i];a&&this.rem(a),t[i]=0}},e.index=10,e.items=Object.create(null),e.added=!1,e.cnt=0,e._tmpDel=new Array(100),e}();__reflect(a.prototype,"Timeout"),t.delayCall=n,t.clearDelay=o}(t=e.time||(e.time={}))}(base||(base={}));var base;!function(e){var t=egret.Event,n=e.time.TimeMgr,o=function(e){function o(){var n=e.call(this)||this;return n.addEventListener(t.ADDED_TO_STAGE,n.onAddToStage,n),n}return __extends(o,e),o.prototype.onAddToStage=function(){var e=this;e.init(),e.onInit(),e.stage.addEventListener(t.RESIZE,e.onResize,e),e.stage.addEventListener(t.DEACTIVATE,e.onDeActivate,e),e.stage.addEventListener(t.ACTIVATE,e.onActivate,e),e.onResize()},o.prototype.init=function(){n.init()},o.prototype.onInit=function(){},o.prototype.onResize=function(e){},o.prototype.onActivate=function(e){},o.prototype.onDeActivate=function(e){},o}(egret.DisplayObjectContainer);e.Base=o,__reflect(o.prototype,"base.Base")}(base||(base={}));var base;!function(e){var t;!function(t){var n=e.utils.Handler,o=e.module.GameNT,r=e.utils.LinkedList,i=e.pool.Pool,s=function(){function e(){this._moduleMap=Object.create(null),this._observerMap=Object.create(null)}return e.prototype.regMod=function(e){this._moduleMap[e.getName()]=e,e.onRegister()},e.prototype.retMod=function(e){return this._moduleMap[e]},e.prototype.showView=function(e,t,n){var o=this._moduleMap[e];o&&o.showView(t,n)},e.prototype.hideView=function(e,t){var n=this._moduleMap[e];n&&n.hideView(t)},e.prototype.sendNt=function(e,t){var n=this._observerMap[e];if(null!=n){n=n.clone();for(var r,s=o.alloc(e,t),a=n.begin,c=n.end;a!=c;)r=a.data,a=a.next,r.exec(s);i.release(n),i.release(s)}},e.prototype.onNt=function(e,t,o){var s=this._observerMap[e];if(null==s)s=this._observerMap[e]=i.alloc(r);else{var a=s.find2(function(e){return n.equalMethod(e,t,o)});if(a)return}s.push(n.alloc(o,t))},e.prototype.offNt=function(e,t,o){var r=this._observerMap[e];if(null!=r){var s=r.find2(function(e){return n.equalMethod(e,t,o)});if(s){var a=s.data;i.release(a),i.release(s)}}},e.prototype.onConnectLost=function(){for(var e in this._moduleMap)this._moduleMap[e].onConnectLost()},e}();t.Facade=s,__reflect(s.prototype,"base.module.Facade"),t.facade=new s}(t=e.module||(e.module={}))}(base||(base={}));var base;!function(e){var t;!function(t){var n=e.pool.Pool,o=function(){function e(){this._connected=!1,this._connecting=!1}return Object.defineProperty(e.prototype,"connected",{get:function(){return this._connected},enumerable:!0,configurable:!0}),e.prototype.connect=function(e){this._connected||this._connecting||(this._connecting=!0,this.socket=new WebSocket(e),this.socket.binaryType="arraybuffer",this._bindEvent())},e.prototype.close=function(){this._connected&&this.socket.close()},e.prototype.send=function(e){this._connected&&this.socket.send(e)},e.prototype._bindEvent=function(){var e=this,t=e.socket;t.onopen=function(t){e._connected=!0,e._connecting=!1,e.onOpen&&e.onOpen.exec()},t.onclose=function(t){e._connected=!1,e.onClose&&e.onClose.exec()},t.onerror=function(t){e._connecting&&(e._connecting=!1),e.onError&&e.onError.exec()},t.onmessage=function(t){var n=t.data,o=n;"string"==typeof n&&(o=(new TextEncoder).encode(n).buffer),e.onMessage&&e.onMessage.exec(o)}},e.prototype.dispose=function(){var e=this;n.release(e.onMessage),e.onMessage=void 0,n.release(e.onOpen),e.onOpen=void 0,n.release(e.onClose),e.onClose=void 0,n.release(e.onError),e.onError=void 0},e}();t.Socket=o,__reflect(o.prototype,"base.network.Socket")}(t=e.network||(e.network={}))}(base||(base={})),function(e){if(e.TextEncoder&&e.TextDecoder)return!1;var t=function(){function e(e){if(void 0===e&&(e="utf-8"),this.encoding="utf-8","utf-8"!==e)throw new RangeError("Failed to construct 'TextEncoder': The encoding label provided ('"+e+"') is invalid.")}return e.prototype.encode=function(e){for(var t=0,n=e.length,o=0,r=Math.max(32,n+(n>>1)+7),i=new Uint8Array(r>>3<<3);n>t;){var s=e.charCodeAt(t++);if(s>=55296&&56319>=s){if(n>t){var a=e.charCodeAt(t);56320===(64512&a)&&(++t,s=((1023&s)<<10)+(1023&a)+65536)}if(s>=55296&&56319>=s)continue}if(o+4>i.length){r+=8,r*=1+t/e.length*2,r=r>>3<<3;var c=new Uint8Array(r);c.set(i),i=c}if(0!==(4294967168&s)){if(0===(4294965248&s))i[o++]=s>>6&31|192;else if(0===(4294901760&s))i[o++]=s>>12&15|224,i[o++]=s>>6&63|128;else{if(0!==(4292870144&s))continue;i[o++]=s>>18&7|240,i[o++]=s>>12&63|128,i[o++]=s>>6&63|128}i[o++]=63&s|128}else i[o++]=s}return i.slice(0,o)},e}(),n=function(){function e(e,t){if(void 0===e&&(e="utf-8"),void 0===t&&(t={fatal:!1}),this.encoding="utf-8",this.fatal=!1,this.ignoreBOM=!1,"utf-8"!==e)throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}return e.prototype.decode=function(e,t){if(void 0===t&&(t={stream:!1}),t.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");for(var n=new Uint8Array(e),o=0,r=n.length,i=[];r>o;){var s=n[o++];if(0===s)break;if(0===(128&s))i.push(s);else if(192===(224&s)){var a=63&n[o++];i.push((31&s)<<6|a)}else if(224===(240&s)){var a=63&n[o++],c=63&n[o++];i.push((31&s)<<12|a<<6|c)}else if(240===(248&s)){var a=63&n[o++],c=63&n[o++],u=63&n[o++],l=(7&s)<<18|a<<12|c<<6|u;l>65535&&(l-=65536,i.push(l>>>10&1023|55296),l=56320|1023&l),i.push(l)}}return String.fromCharCode.apply(null,i)},e}();e.TextEncoder=t,e.TextDecoder=n}("undefined"!=typeof window?window:"undefined"!=typeof global?global:this);